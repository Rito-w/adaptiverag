# 🎛️ AdaptiveRAG 模块控制功能指南

## 📋 概述

AdaptiveRAG 现在支持通过 WebUI 界面实时控制各个功能模块的开启和关闭。这个功能让您可以：

- 🔧 **精细控制**：独立控制31个不同的功能模块
- ⚡ **实时调整**：无需重启系统即可应用配置更改
- 🎯 **预设模式**：快速应用预定义的配置组合
- 📊 **状态监控**：实时查看模块启用状态和系统概览
- 💾 **配置保存**：保存和加载自定义配置

## 🚀 快速开始

### 启动带模块控制的 WebUI

```bash
# 激活环境
source /etc/network_turbo
conda activate flexrag
cd /root/my_project

# 启动 WebUI (新的模块控制版本)
python3 adaptiverag/launch_webui_with_module_control.py --port 7863 --host 0.0.0.0

# 或者使用原有的启动方式
python3 -m adaptiverag.adaptive_rag.webui.enhanced_main_interface --port 7863 --host 0.0.0.0 --config-path adaptiverag/configs/real_config_enhanced.yaml
```

### 访问模块控制界面

1. 打开浏览器访问：`http://your-server:7863`
2. 点击 **🎛️ 模块控制** 标签页
3. 开始配置您的模块！

## 🎛️ 模块控制界面详解

### 📊 系统状态面板

显示当前系统的概览信息：
- **启用模块数**：当前启用的模块数量
- **启用率**：模块启用的百分比
- **系统状态**：整体运行状态

### 🚀 快速配置

#### 预设模式

1. **基础模式 (basic_mode)**
   - 适用于：开发测试、资源受限环境
   - 特点：只启用核心功能，资源消耗最低
   - 启用模块：任务分解、检索规划、基础检索、生成器

2. **高性能模式 (performance_mode)**
   - 适用于：生产环境、完整功能需求
   - 特点：启用所有稳定功能，性能最优
   - 启用模块：所有核心功能 + 高级检索 + 重排序

3. **实验模式 (experimental_mode)**
   - 适用于：研究开发、功能测试
   - 特点：启用所有功能包括实验性功能
   - 启用模块：全部31个模块

#### 操作按钮

- **应用预设配置**：快速应用选中的预设模式
- **保存当前配置**：将当前设置保存为配置文件
- **重新加载配置**：从配置文件重新加载设置

### 🔧 模块控制面板

#### 🧩 核心处理模块
- **任务分解器**：将复杂查询分解为子任务
- **检索规划器**：制定检索策略和权重分配
- **多重检索系统**：并行执行多种检索方法
- **上下文重排器**：优化检索结果排序
- **自适应生成器**：生成最终响应

#### 🧠 智能分析模块
- **查询分析器**：分析查询复杂度和类型
- **策略路由器**：动态选择最优检索策略
- **性能优化器**：持续优化系统性能
- **智能策略学习器**：从历史数据学习最优策略（实验性）
- **多维度优化器**：多维度决策优化（实验性）
- **资源感知优化器**：资源感知优化（实验性）

#### 🔍 检索器模块
- **关键词检索器**：基于关键词的检索
- **密集检索器**：基于密集向量的检索
- **网络检索器**：实时网络搜索（需要API）
- **混合检索器**：混合检索方法

#### 🎯 重排序模块
- **交叉编码器重排**：深度交互重排序
- **ColBERT重排**：高效后期交互（需要模型）
- **GPT重排**：LLM智能重排（需要API）

#### ✨ 生成器模块
- **模板生成器**：基于模板的生成
- **自由形式生成器**：自由形式生成
- **对话生成器**：对话生成（实验性）

#### 📊 评估和缓存模块
- **事实验证**：事实验证（实验性）
- **置信度估计**：置信度估计
- **结果分析器**：结果分析
- **语义缓存**：语义缓存
- **预测性缓存**：预测性缓存（实验性）

#### 🎨 用户体验和调试模块
- **个性化**：个性化（实验性）
- **多模态支持**：多模态支持（实验性）
- **调试模式**：调试模式
- **性能监控**：性能监控
- **增强日志**：增强日志

## 💡 使用建议

### 🎯 场景化配置

#### 开发测试环境
```
推荐：基础模式
启用：核心处理模块 + 基础检索 + 调试模式
禁用：实验性功能、网络检索、高级重排序
```

#### 生产环境
```
推荐：高性能模式
启用：所有稳定功能 + 性能监控
禁用：调试模式、实验性功能
```

#### 研究实验
```
推荐：实验模式
启用：所有功能
注意：需要足够的计算资源
```

### ⚡ 性能优化建议

1. **资源受限时**：
   - 禁用网络检索器
   - 禁用ColBERT和GPT重排序
   - 禁用实验性功能

2. **追求准确性时**：
   - 启用所有检索器
   - 启用交叉编码器重排序
   - 启用事实验证

3. **追求速度时**：
   - 禁用重排序模块
   - 启用语义缓存
   - 禁用复杂的优化器

## 🔧 技术实现

### 配置文件结构

模块配置存储在 `adaptive_rag/config/modular_config.yaml` 中：

```yaml
modules:
  # 核心处理模块
  task_decomposer: true
  retrieval_planner: true
  multi_retriever: true
  context_reranker: true
  adaptive_generator: true
  
  # 智能分析模块
  query_analyzer: true
  strategy_router: true
  performance_optimizer: true
  # ... 更多模块配置
```

### API 接口

```python
# 获取模块状态
status = engine.get_module_status()

# 更新模块配置
config = {
    "task_decomposer": True,
    "web_retriever": False,
    # ... 其他模块
}
engine.update_module_config(config)

# 获取当前配置
current_config = engine.get_current_module_config()
```

## 🐛 故障排除

### 常见问题

1. **模块更新失败**
   - 检查配置文件权限
   - 确认模块依赖关系
   - 查看错误日志

2. **某些模块无法启用**
   - 检查是否缺少依赖
   - 确认API密钥配置
   - 验证模型文件存在

3. **性能下降**
   - 减少启用的模块数量
   - 禁用实验性功能
   - 检查资源使用情况

### 调试方法

1. 启用调试模式
2. 查看增强日志
3. 使用资源监控标签页
4. 检查模块状态面板

## 📞 支持

如果您在使用模块控制功能时遇到问题：

1. 查看控制台日志输出
2. 检查 `adaptive_rag.log` 文件
3. 运行测试脚本：`python3 adaptiverag/test_webui_module_control.py`
4. 参考其他标签页的功能状态

---

🎉 **享受您的模块化 AdaptiveRAG 体验！**
